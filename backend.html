<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>JSON Database Admin – Pure PHP in Browser</title>
<style>
  body {font-family:monospace;background:#000;color:#0f0;padding:20px;}
  textarea {width:100%;height:400px;background:#111;color:#0f0;border:2px solid #0f0;padding:10px;font-size:14px;}
  button {padding:10px 20px;background:#0f0;color:#000;border:none;font-weight:bold;cursor:pointer;margin:10px 0;}
  pre {background:#111;padding:15px;border:2px solid #0f0;margin-top:20px;white-space:pre-wrap;}
</style>
</head>
<body>

<h1>JSON Database Admin Panel</h1>
<p>This is pure PHP running in your browser. Edit the JSON below, click Save, and download the updated database.json to share with everyone.</p>

<textarea id="jsonEditor"><?php
// Pure PHP starts here
$file = 'database.json';

// Init if missing
if (!file_exists($file)) {
  $init = json_encode(["messages" => []], JSON_PRETTY_PRINT);
  file_put_contents($file, $init);
}

// Load data
$data = json_decode(file_get_contents($file), true);

// Output JSON
echo htmlspecialchars(json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES));
?>
</textarea><br>

<button onclick="saveDatabase()">Save & Download Updated database.json</button>
<button onclick="addSampleMessage()">Add Sample Message</button>

<pre id="out">Ready. Edit JSON → Save → Upload new database.json to host.</pre>

<script>
// Move scripts before buttons to fix "not defined"
function saveDatabase() {
  const json = document.getElementById("jsonEditor").value;
  try {
    JSON.parse(json); // Validate
  } catch (e) {
    alert("Invalid JSON! Fix it.");
    return;
  }

  // Download as database.json
  const blob = new Blob([json], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'database.json';
  a.click();

  document.getElementById("out").textContent = "Saved! Upload this new database.json to your host. Everyone will see the changes.";
}

function addSampleMessage() {
  const ta = document.getElementById("jsonEditor");
  try {
    const data = JSON.parse(ta.value);
    data.messages.push({
      name: "Admin",
      message: "Sample message from backend at " + new Date().toLocaleString(),
      time: new Date().toLocaleString()
    });
    ta.value = JSON.stringify(data, null, 2);
    document.getElementById("out").textContent = "Sample added! Click Save to download.";
  } catch (e) {
    alert("Invalid JSON!");
  }
}
</script>

<?php
// PHP stats
echo "<pre>";
echo "Database size: " . filesize($file) . " bytes\n";
echo "Messages: " . count($data['messages']) . "\n";
echo "Last modified: " . date("Y-m-d H:i:s", filemtime($file)) . "\n";
echo "</pre>";
?>

</body>
</html>
